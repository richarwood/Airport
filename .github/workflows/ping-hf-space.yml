# 放到 .github/workflows/ping-hf-space.yml
name: Keep Hugging Face Space Awake (daily)

on:
  schedule:
    # 每日一次（UTC 零点），按需调整 cron 表达式
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  ping-space:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Hugging Face Space
        env:
          SPACE_URL: "https://huggingface.co/spaces/richarwood/airport"
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          echo "Pinging $SPACE_URL"
          if [ -n "$HF_TOKEN" ]; then
            echo "Using HF_TOKEN (private space)"
            HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" -L --max-time 30 -A "github-action-pinger/1.0" -H "Authorization: Bearer $HF_TOKEN" "$SPACE_URL")
          else
            HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" -L --max-time 30 -A "github-action-pinger/1.0" "$SPACE_URL")
          fi
          echo "HTTP status: $HTTP_STATUS"
          if [ "$HTTP_STATUS" -ge 400 ]; then
            echo "非成功状态码，退出并标记为失败"
            exit 1
          fi
